# 数据库SQL文件使用说明

## 文件概述

本项目提供了两个数据库初始化SQL文件，分别适用于不同的数据库系统：

### 1. `database.sql` - MySQL版本
- **适用于**: MySQL 5.7+ 数据库
- **特点**: 使用MySQL特有的语法和功能
- **用途**: 如果你使用传统的MySQL数据库服务器

### 2. `supabase-database.sql` - PostgreSQL/Supabase版本
- **适用于**: Supabase平台（基于PostgreSQL）
- **特点**: 包含PostgreSQL语法、RLS安全策略、触发器等高级功能
- **用途**: 推荐用于本项目，因为我们使用Supabase作为后端服务

## 数据库表结构

### 用户表 (users)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| user_id | 主键 | 用户唯一标识 |
| username | VARCHAR(50) | 用户名，用于登录 |
| password | VARCHAR(255) | 加密后的密码 |
| role | ENUM | 用户角色：admin(管理员)、user(普通用户) |
| created_at | TIMESTAMP | 账号创建时间 |

### 分类表 (categories)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| category_id | 主键 | 分类唯一标识 |
| name | VARCHAR(100) | 分类名称 |
| description | TEXT | 分类描述 |
| color | VARCHAR(7) | 分类颜色（十六进制，如#3498db） |
| created_at | TIMESTAMP | 分类创建时间 |
| creator_id | 外键 | 创建该分类的管理员ID |

### 任务表 (tasks)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| task_id | 主键 | 任务唯一标识 |
| title | VARCHAR(200) | 任务标题 |
| description | TEXT | 任务详细描述 |
| category_id | 外键 | 任务所属分类 |
| status | ENUM | 任务状态：待领取、进行中、已完成、已逾期 |
| priority | VARCHAR(10) | 任务优先级：low、medium、high |
| created_at | TIMESTAMP | 任务创建时间 |
| updated_at | TIMESTAMP | 任务更新时间 |
| due_date | DATE | 任务截止日期 |
| creator_id | 外键 | 创建该任务的管理员ID |
| assignee_id | 外键 | 负责该任务的用户ID（可为空） |

## 如何使用

### 方法一：在Supabase中使用（推荐）

1. 登录你的Supabase项目控制台
2. 进入「SQL Editor」页面
3. 复制 `supabase-database.sql` 文件的全部内容
4. 粘贴到SQL编辑器中
5. 点击「Run」按钮执行
6. 等待执行完成，查看结果

### 方法二：在MySQL中使用

1. 连接到你的MySQL数据库
2. 创建一个新的数据库（如果还没有）：
   ```sql
   CREATE DATABASE task_management;
   USE task_management;
   ```
3. 复制 `database.sql` 文件的全部内容
4. 在MySQL客户端中执行这些SQL语句

## 初始数据说明

### 默认用户账号
| 用户名 | 密码 | 角色 | 说明 |
|--------|------|------|------|
| admin | admin123 | 管理员 | 系统管理员账号 |
| manager | manager123 | 管理员 | 管理员账号 |
| zhangsan | user123 | 普通用户 | 测试用户 |
| lisi | user123 | 普通用户 | 测试用户 |
| wangwu | user123 | 普通用户 | 测试用户 |

### 默认分类
- **开发任务** (红色 #e74c3c): 与软件开发相关的任务
- **测试任务** (橙色 #f39c12): 软件测试和质量保证相关的任务
- **设计任务** (紫色 #9b59b6): 界面设计和用户体验相关的任务
- **文档任务** (蓝色 #3498db): 文档编写和维护相关的任务
- **运维任务** (绿色 #2ecc71): 系统运维和部署相关的任务

### 示例任务
系统会自动创建5个示例任务，展示不同的状态和优先级。

## 安全特性（仅Supabase版本）

### 行级安全策略 (RLS)
Supabase版本包含了行级安全策略，确保：
- 用户只能查看自己的个人信息
- 管理员可以查看所有用户信息
- 所有用户都可以查看分类和任务
- 只有管理员可以创建、修改、删除分类和任务
- 用户可以更新分配给自己的任务状态

### 自动更新时间戳
任务表包含自动更新的 `updated_at` 字段，每次任务被修改时会自动更新时间戳。

## 性能优化

两个版本都包含了以下索引以提高查询性能：
- 任务状态索引
- 任务分配者索引
- 任务创建者索引
- 任务分类索引
- 任务截止日期索引
- 任务优先级索引
- 用户名索引
- 分类名称索引

## 注意事项

1. **密码安全**: 示例中的密码是明文存储的，仅用于演示。在生产环境中，密码必须经过哈希加密处理。

2. **数据备份**: 在执行SQL脚本之前，请确保备份现有数据（如果有的话）。

3. **权限设置**: 确保数据库用户有足够的权限来创建表、索引和插入数据。

4. **字符编码**: 建议使用UTF-8编码以支持中文字符。

5. **时区设置**: Supabase版本使用带时区的时间戳，请注意时区设置。

## 故障排除

### 常见错误及解决方案

1. **表已存在错误**
   - 脚本开头包含了 `DROP TABLE IF EXISTS` 语句，会自动删除已存在的表
   - 如果仍有问题，请手动删除相关表后重新执行

2. **外键约束错误**
   - 确保按照脚本顺序执行，先创建用户表，再创建分类表，最后创建任务表
   - 检查引用的用户ID是否存在

3. **权限不足错误**
   - 确保数据库用户有CREATE、INSERT、DROP等权限
   - 在Supabase中，确保你是项目的所有者或有足够权限

4. **字符编码问题**
   - 确保数据库和连接都使用UTF-8编码
   - 在MySQL中可以使用：`SET NAMES utf8mb4;`

## 联系支持

如果在使用过程中遇到问题，请检查：
1. 数据库版本是否兼容
2. 用户权限是否足够
3. 网络连接是否正常
4. SQL语法是否正确执行

建议在测试环境中先验证SQL脚本，确认无误后再在生产环境中使用。